<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>第8章 输入输出系统 | Home</title><meta name=keywords content="Principles of Computer Organization"><meta name=description content="输入与输出系统 输入与输出系统
外围设备的定时方式和信息交换方式 根据外设速度把外设分类：
速度极慢或简单的外设 CPU只需要接收或者发送数据即可。无条件传送 慢速或者中速的设备 异步传送方式（应答） 高速外设 同步传送 数据传输方式：
程序查询方式(Polling) 程序中断方式 直接存储器存取(DMA: Direct Memory Access) 通道方式（过时） 程序查询方式 最简单的输入输出方式
CPU需要不断查询并等待慢速外设 效率低，CPU与外设不能并行工作。如果外设多，可能还需要链式查询，慢 接口电路简单，硬件开销小 程序中断方式 外设通过接口向CPU发出中断请求，CPU有能力执行中断时转去执行中断，执行完毕后再回到主程序
中断系统是计算机实现中断功能的软硬件总称，一般包括：
在CPU中设置的中断机构 在系统中设置的中断控制器 在软件上设置相应的中断服务程序 中断处理过程：
中断请求 中断排队与判优 中断响应 暂时中断主程序（即现在执行的程序），发出中断响应信号 保存断点（即返回地址） 关中断（不再允许中断） 查找中断源，获取中断服务程序的入口地址 中断处理 保护现场（即保护主程序目前的状态） 中断服务（即给中断源提供服务） 恢复现场并中断返回，开中断（允许中断） 中断源的识别：
单级中断中采用串行排队链实现公共请求线的中断源判优识别 也可以采用中断控制器判断 转中断服务程序的方法：
预先规定中断服务程序的入口地址 或使用中断向量（类似于设备的名字），通过链式查表的方式找到入口地址 如图，使用中断向量和中断控制器，首先根据中断控制器获取中断向量
然后根据中断向量链式查找设备入口地址
单级中断不允许其他程序在中断中再次中断，中断响应不允许嵌套
多级中断通常称为中断嵌套方式，优先级高的中断可以打断优先级低的中断。类似于高级语言中的函数嵌套。使用堆栈保存现场
二维多级中断结构
DMA方式 正常情况下外设从内存获得数据需要通过CPU的中转。而CPU为运算设计，所以单独设计一个用于数据转移的部件DMA控制器
基本思想：通过硬件实现主存与IO设备的直接数据传送，传送过程中无需CPU干预，速度快
过程：
申请阶段 - DMA控制器收到DMA传送请求后向CPU发出总线请求信号申请占用总线 响应阶段 - CPU响应总线请求，释放总线，回送总线应答信号，表示已经让出总线 数据传送阶段 - DMA控制器收到总线应答信号后占用总线，分别向存储器和外设发出读写控制信号，完成数据传送操作，记录传送字的个数 传送结束阶段 - 规定字数传送完毕后DMA控制器以中断方式或状态位的方式向CPU报告，释放总线，CPU重新占用总线 DMA传送方式：
成组传送 传送过程中CPU停止访存 控制简单，适用于数据传输率很高的设备 但是CPU无法处理紧急事件，数据块也不能太大 周期窃取 每次占用一个CPU周期，只让CPU暂停工作一个周期 但是总线申请和归还存在过多的时间开销 DMA与CPU交替访存 不需要总线使用权的申请与归还，总线使用权通过C1和C2分时进行(C1+C2=CPU周期) 也称为透明DMA方式，CPU不停止主程序也不等待 前提条件：CPU工作周期比内存存取周期长很多 通道方式 通道是计算机系统中代替CPU管理外设的独立部件，是一种能执行有限IO指令集的处理机 一个主机可以连接几个通道，每个通道可以连接多个IO设备 通道完成IO操作而不需CPU介入，数据交换结束后向CPU发出中断请求交换数据 通道类型："><meta name=author content="Chan"><link rel=canonical href=/posts/principles-of-computer-organization/%E7%AC%AC8%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%B3%BB%E7%BB%9F/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="第8章 输入输出系统"><meta property="og:description" content="输入与输出系统 输入与输出系统
外围设备的定时方式和信息交换方式 根据外设速度把外设分类：
速度极慢或简单的外设 CPU只需要接收或者发送数据即可。无条件传送 慢速或者中速的设备 异步传送方式（应答） 高速外设 同步传送 数据传输方式：
程序查询方式(Polling) 程序中断方式 直接存储器存取(DMA: Direct Memory Access) 通道方式（过时） 程序查询方式 最简单的输入输出方式
CPU需要不断查询并等待慢速外设 效率低，CPU与外设不能并行工作。如果外设多，可能还需要链式查询，慢 接口电路简单，硬件开销小 程序中断方式 外设通过接口向CPU发出中断请求，CPU有能力执行中断时转去执行中断，执行完毕后再回到主程序
中断系统是计算机实现中断功能的软硬件总称，一般包括：
在CPU中设置的中断机构 在系统中设置的中断控制器 在软件上设置相应的中断服务程序 中断处理过程：
中断请求 中断排队与判优 中断响应 暂时中断主程序（即现在执行的程序），发出中断响应信号 保存断点（即返回地址） 关中断（不再允许中断） 查找中断源，获取中断服务程序的入口地址 中断处理 保护现场（即保护主程序目前的状态） 中断服务（即给中断源提供服务） 恢复现场并中断返回，开中断（允许中断） 中断源的识别：
单级中断中采用串行排队链实现公共请求线的中断源判优识别 也可以采用中断控制器判断 转中断服务程序的方法：
预先规定中断服务程序的入口地址 或使用中断向量（类似于设备的名字），通过链式查表的方式找到入口地址 如图，使用中断向量和中断控制器，首先根据中断控制器获取中断向量
然后根据中断向量链式查找设备入口地址
单级中断不允许其他程序在中断中再次中断，中断响应不允许嵌套
多级中断通常称为中断嵌套方式，优先级高的中断可以打断优先级低的中断。类似于高级语言中的函数嵌套。使用堆栈保存现场
二维多级中断结构
DMA方式 正常情况下外设从内存获得数据需要通过CPU的中转。而CPU为运算设计，所以单独设计一个用于数据转移的部件DMA控制器
基本思想：通过硬件实现主存与IO设备的直接数据传送，传送过程中无需CPU干预，速度快
过程：
申请阶段 - DMA控制器收到DMA传送请求后向CPU发出总线请求信号申请占用总线 响应阶段 - CPU响应总线请求，释放总线，回送总线应答信号，表示已经让出总线 数据传送阶段 - DMA控制器收到总线应答信号后占用总线，分别向存储器和外设发出读写控制信号，完成数据传送操作，记录传送字的个数 传送结束阶段 - 规定字数传送完毕后DMA控制器以中断方式或状态位的方式向CPU报告，释放总线，CPU重新占用总线 DMA传送方式：
成组传送 传送过程中CPU停止访存 控制简单，适用于数据传输率很高的设备 但是CPU无法处理紧急事件，数据块也不能太大 周期窃取 每次占用一个CPU周期，只让CPU暂停工作一个周期 但是总线申请和归还存在过多的时间开销 DMA与CPU交替访存 不需要总线使用权的申请与归还，总线使用权通过C1和C2分时进行(C1+C2=CPU周期) 也称为透明DMA方式，CPU不停止主程序也不等待 前提条件：CPU工作周期比内存存取周期长很多 通道方式 通道是计算机系统中代替CPU管理外设的独立部件，是一种能执行有限IO指令集的处理机 一个主机可以连接几个通道，每个通道可以连接多个IO设备 通道完成IO操作而不需CPU介入，数据交换结束后向CPU发出中断请求交换数据 通道类型："><meta property="og:type" content="article"><meta property="og:url" content="/posts/principles-of-computer-organization/%E7%AC%AC8%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%B3%BB%E7%BB%9F/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-21T16:29:43+00:00"><meta property="article:modified_time" content="2023-02-21T16:29:43+00:00"><meta property="og:site_name" content="Chancellor16's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="第8章 输入输出系统"><meta name=twitter:description content="输入与输出系统 输入与输出系统
外围设备的定时方式和信息交换方式 根据外设速度把外设分类：
速度极慢或简单的外设 CPU只需要接收或者发送数据即可。无条件传送 慢速或者中速的设备 异步传送方式（应答） 高速外设 同步传送 数据传输方式：
程序查询方式(Polling) 程序中断方式 直接存储器存取(DMA: Direct Memory Access) 通道方式（过时） 程序查询方式 最简单的输入输出方式
CPU需要不断查询并等待慢速外设 效率低，CPU与外设不能并行工作。如果外设多，可能还需要链式查询，慢 接口电路简单，硬件开销小 程序中断方式 外设通过接口向CPU发出中断请求，CPU有能力执行中断时转去执行中断，执行完毕后再回到主程序
中断系统是计算机实现中断功能的软硬件总称，一般包括：
在CPU中设置的中断机构 在系统中设置的中断控制器 在软件上设置相应的中断服务程序 中断处理过程：
中断请求 中断排队与判优 中断响应 暂时中断主程序（即现在执行的程序），发出中断响应信号 保存断点（即返回地址） 关中断（不再允许中断） 查找中断源，获取中断服务程序的入口地址 中断处理 保护现场（即保护主程序目前的状态） 中断服务（即给中断源提供服务） 恢复现场并中断返回，开中断（允许中断） 中断源的识别：
单级中断中采用串行排队链实现公共请求线的中断源判优识别 也可以采用中断控制器判断 转中断服务程序的方法：
预先规定中断服务程序的入口地址 或使用中断向量（类似于设备的名字），通过链式查表的方式找到入口地址 如图，使用中断向量和中断控制器，首先根据中断控制器获取中断向量
然后根据中断向量链式查找设备入口地址
单级中断不允许其他程序在中断中再次中断，中断响应不允许嵌套
多级中断通常称为中断嵌套方式，优先级高的中断可以打断优先级低的中断。类似于高级语言中的函数嵌套。使用堆栈保存现场
二维多级中断结构
DMA方式 正常情况下外设从内存获得数据需要通过CPU的中转。而CPU为运算设计，所以单独设计一个用于数据转移的部件DMA控制器
基本思想：通过硬件实现主存与IO设备的直接数据传送，传送过程中无需CPU干预，速度快
过程：
申请阶段 - DMA控制器收到DMA传送请求后向CPU发出总线请求信号申请占用总线 响应阶段 - CPU响应总线请求，释放总线，回送总线应答信号，表示已经让出总线 数据传送阶段 - DMA控制器收到总线应答信号后占用总线，分别向存储器和外设发出读写控制信号，完成数据传送操作，记录传送字的个数 传送结束阶段 - 规定字数传送完毕后DMA控制器以中断方式或状态位的方式向CPU报告，释放总线，CPU重新占用总线 DMA传送方式：
成组传送 传送过程中CPU停止访存 控制简单，适用于数据传输率很高的设备 但是CPU无法处理紧急事件，数据块也不能太大 周期窃取 每次占用一个CPU周期，只让CPU暂停工作一个周期 但是总线申请和归还存在过多的时间开销 DMA与CPU交替访存 不需要总线使用权的申请与归还，总线使用权通过C1和C2分时进行(C1+C2=CPU周期) 也称为透明DMA方式，CPU不停止主程序也不等待 前提条件：CPU工作周期比内存存取周期长很多 通道方式 通道是计算机系统中代替CPU管理外设的独立部件，是一种能执行有限IO指令集的处理机 一个主机可以连接几个通道，每个通道可以连接多个IO设备 通道完成IO操作而不需CPU介入，数据交换结束后向CPU发出中断请求交换数据 通道类型："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"第8章 输入输出系统","item":"/posts/principles-of-computer-organization/%E7%AC%AC8%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%B3%BB%E7%BB%9F/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"第8章 输入输出系统","name":"第8章 输入输出系统","description":"输入与输出系统 输入与输出系统\n外围设备的定时方式和信息交换方式 根据外设速度把外设分类：\n速度极慢或简单的外设 CPU只需要接收或者发送数据即可。无条件传送 慢速或者中速的设备 异步传送方式（应答） 高速外设 同步传送 数据传输方式：\n程序查询方式(Polling) 程序中断方式 直接存储器存取(DMA: Direct Memory Access) 通道方式（过时） 程序查询方式 最简单的输入输出方式\nCPU需要不断查询并等待慢速外设 效率低，CPU与外设不能并行工作。如果外设多，可能还需要链式查询，慢 接口电路简单，硬件开销小 程序中断方式 外设通过接口向CPU发出中断请求，CPU有能力执行中断时转去执行中断，执行完毕后再回到主程序\n中断系统是计算机实现中断功能的软硬件总称，一般包括：\n在CPU中设置的中断机构 在系统中设置的中断控制器 在软件上设置相应的中断服务程序 中断处理过程：\n中断请求 中断排队与判优 中断响应 暂时中断主程序（即现在执行的程序），发出中断响应信号 保存断点（即返回地址） 关中断（不再允许中断） 查找中断源，获取中断服务程序的入口地址 中断处理 保护现场（即保护主程序目前的状态） 中断服务（即给中断源提供服务） 恢复现场并中断返回，开中断（允许中断） 中断源的识别：\n单级中断中采用串行排队链实现公共请求线的中断源判优识别 也可以采用中断控制器判断 转中断服务程序的方法：\n预先规定中断服务程序的入口地址 或使用中断向量（类似于设备的名字），通过链式查表的方式找到入口地址 如图，使用中断向量和中断控制器，首先根据中断控制器获取中断向量\n然后根据中断向量链式查找设备入口地址\n单级中断不允许其他程序在中断中再次中断，中断响应不允许嵌套\n多级中断通常称为中断嵌套方式，优先级高的中断可以打断优先级低的中断。类似于高级语言中的函数嵌套。使用堆栈保存现场\n二维多级中断结构\nDMA方式 正常情况下外设从内存获得数据需要通过CPU的中转。而CPU为运算设计，所以单独设计一个用于数据转移的部件DMA控制器\n基本思想：通过硬件实现主存与IO设备的直接数据传送，传送过程中无需CPU干预，速度快\n过程：\n申请阶段 - DMA控制器收到DMA传送请求后向CPU发出总线请求信号申请占用总线 响应阶段 - CPU响应总线请求，释放总线，回送总线应答信号，表示已经让出总线 数据传送阶段 - DMA控制器收到总线应答信号后占用总线，分别向存储器和外设发出读写控制信号，完成数据传送操作，记录传送字的个数 传送结束阶段 - 规定字数传送完毕后DMA控制器以中断方式或状态位的方式向CPU报告，释放总线，CPU重新占用总线 DMA传送方式：\n成组传送 传送过程中CPU停止访存 控制简单，适用于数据传输率很高的设备 但是CPU无法处理紧急事件，数据块也不能太大 周期窃取 每次占用一个CPU周期，只让CPU暂停工作一个周期 但是总线申请和归还存在过多的时间开销 DMA与CPU交替访存 不需要总线使用权的申请与归还，总线使用权通过C1和C2分时进行(C1+C2=CPU周期) 也称为透明DMA方式，CPU不停止主程序也不等待 前提条件：CPU工作周期比内存存取周期长很多 通道方式 通道是计算机系统中代替CPU管理外设的独立部件，是一种能执行有限IO指令集的处理机 一个主机可以连接几个通道，每个通道可以连接多个IO设备 通道完成IO操作而不需CPU介入，数据交换结束后向CPU发出中断请求交换数据 通道类型：","keywords":["Principles of Computer Organization"],"articleBody":"输入与输出系统 输入与输出系统\n外围设备的定时方式和信息交换方式 根据外设速度把外设分类：\n速度极慢或简单的外设 CPU只需要接收或者发送数据即可。无条件传送 慢速或者中速的设备 异步传送方式（应答） 高速外设 同步传送 数据传输方式：\n程序查询方式(Polling) 程序中断方式 直接存储器存取(DMA: Direct Memory Access) 通道方式（过时） 程序查询方式 最简单的输入输出方式\nCPU需要不断查询并等待慢速外设 效率低，CPU与外设不能并行工作。如果外设多，可能还需要链式查询，慢 接口电路简单，硬件开销小 程序中断方式 外设通过接口向CPU发出中断请求，CPU有能力执行中断时转去执行中断，执行完毕后再回到主程序\n中断系统是计算机实现中断功能的软硬件总称，一般包括：\n在CPU中设置的中断机构 在系统中设置的中断控制器 在软件上设置相应的中断服务程序 中断处理过程：\n中断请求 中断排队与判优 中断响应 暂时中断主程序（即现在执行的程序），发出中断响应信号 保存断点（即返回地址） 关中断（不再允许中断） 查找中断源，获取中断服务程序的入口地址 中断处理 保护现场（即保护主程序目前的状态） 中断服务（即给中断源提供服务） 恢复现场并中断返回，开中断（允许中断） 中断源的识别：\n单级中断中采用串行排队链实现公共请求线的中断源判优识别 也可以采用中断控制器判断 转中断服务程序的方法：\n预先规定中断服务程序的入口地址 或使用中断向量（类似于设备的名字），通过链式查表的方式找到入口地址 如图，使用中断向量和中断控制器，首先根据中断控制器获取中断向量\n然后根据中断向量链式查找设备入口地址\n单级中断不允许其他程序在中断中再次中断，中断响应不允许嵌套\n多级中断通常称为中断嵌套方式，优先级高的中断可以打断优先级低的中断。类似于高级语言中的函数嵌套。使用堆栈保存现场\n二维多级中断结构\nDMA方式 正常情况下外设从内存获得数据需要通过CPU的中转。而CPU为运算设计，所以单独设计一个用于数据转移的部件DMA控制器\n基本思想：通过硬件实现主存与IO设备的直接数据传送，传送过程中无需CPU干预，速度快\n过程：\n申请阶段 - DMA控制器收到DMA传送请求后向CPU发出总线请求信号申请占用总线 响应阶段 - CPU响应总线请求，释放总线，回送总线应答信号，表示已经让出总线 数据传送阶段 - DMA控制器收到总线应答信号后占用总线，分别向存储器和外设发出读写控制信号，完成数据传送操作，记录传送字的个数 传送结束阶段 - 规定字数传送完毕后DMA控制器以中断方式或状态位的方式向CPU报告，释放总线，CPU重新占用总线 DMA传送方式：\n成组传送 传送过程中CPU停止访存 控制简单，适用于数据传输率很高的设备 但是CPU无法处理紧急事件，数据块也不能太大 周期窃取 每次占用一个CPU周期，只让CPU暂停工作一个周期 但是总线申请和归还存在过多的时间开销 DMA与CPU交替访存 不需要总线使用权的申请与归还，总线使用权通过C1和C2分时进行(C1+C2=CPU周期) 也称为透明DMA方式，CPU不停止主程序也不等待 前提条件：CPU工作周期比内存存取周期长很多 通道方式 通道是计算机系统中代替CPU管理外设的独立部件，是一种能执行有限IO指令集的处理机 一个主机可以连接几个通道，每个通道可以连接多个IO设备 通道完成IO操作而不需CPU介入，数据交换结束后向CPU发出中断请求交换数据 通道类型：\n选择通道 选择一台外设独占整个通道，以成组传送的方式传送数据块 效率高，适合快速设备 字节多路通道 简单的共享信道 分时处理，面向中低速字符设备 数组多路通道 多个设备以数据块为单位交叉使用通道。结合了以上两种方式 使用多个子通道实现 效率高，但控制复杂 ","wordCount":"95","inLanguage":"en","datePublished":"2023-02-21T16:29:43Z","dateModified":"2023-02-21T16:29:43Z","author":{"@type":"Person","name":"Chan"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/principles-of-computer-organization/%E7%AC%AC8%E7%AB%A0-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%B3%BB%E7%BB%9F/"},"publisher":{"@type":"Organization","name":"Home","logo":{"@type":"ImageObject","url":"%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Cheyne16's Blog (Alt + H)"><img src=/apple-touch-icon.png alt aria-label=logo height=35>Cheyne16's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/categories/ title=categories><span>categories</span></a></li><li><a href=/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/posts/>Posts</a></div><h1 class=post-title>第8章 输入输出系统</h1><div class=post-meta><span title='2023-02-21 16:29:43 +0000 UTC'>February 21, 2023</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;95 words&nbsp;·&nbsp;Chan&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/Principles%20of%20Computer%20Organization/%e7%ac%ac8%e7%ab%a0%20%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e7%b3%bb%e7%bb%9f.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h1 id=输入与输出系统>输入与输出系统<a hidden class=anchor aria-hidden=true href=#输入与输出系统>#</a></h1><p>输入与输出系统</p><h2 id=外围设备的定时方式和信息交换方式>外围设备的定时方式和信息交换方式<a hidden class=anchor aria-hidden=true href=#外围设备的定时方式和信息交换方式>#</a></h2><p>根据外设速度把外设分类：</p><ul><li>速度极慢或简单的外设<ul><li>CPU只需要接收或者发送数据即可。<strong>无条件传送</strong></li></ul></li><li>慢速或者中速的设备<ul><li>异步传送方式（应答）</li></ul></li><li>高速外设<ul><li>同步传送</li></ul></li></ul><p>数据传输方式：</p><ul><li>程序查询方式(Polling)</li><li>程序中断方式</li><li>直接存储器存取(DMA: Direct Memory Access)</li><li>通道方式（过时）</li></ul><h3 id=程序查询方式>程序查询方式<a hidden class=anchor aria-hidden=true href=#程序查询方式>#</a></h3><p>最简单的输入输出方式</p><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/e613bc9.png alt=8-3></p><ul><li>CPU需要不断查询并等待慢速外设</li><li>效率低，CPU与外设不能并行工作。如果外设多，可能还需要链式查询，慢</li><li>接口电路简单，硬件开销小</li></ul><h3 id=程序中断方式>程序中断方式<a hidden class=anchor aria-hidden=true href=#程序中断方式>#</a></h3><p>外设通过接口向CPU发出中断请求，CPU有能力执行中断时转去执行中断，执行完毕后再回到主程序</p><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/9fec7d2.png alt=8-1></p><p><strong>中断系统</strong>是计算机实现中断功能的<strong>软硬件</strong>总称，一般包括：</p><ul><li>在CPU中设置的中断机构</li><li>在系统中设置的中断控制器</li><li>在软件上设置相应的中断服务程序</li></ul><p>中断处理过程：</p><ol><li>中断请求</li><li>中断排队与判优</li><li>中断响应<ol><li>暂时中断主程序（即现在执行的程序），发出中断响应信号</li><li>保存断点（即返回地址）</li><li>关中断（不再允许中断）</li><li>查找中断源，获取中断服务程序的入口地址</li></ol></li><li>中断处理<ol><li>保护现场（即保护主程序目前的状态）</li><li>中断服务（即给中断源提供服务）</li></ol></li><li>恢复现场并中断返回，开中断（允许中断）</li></ol><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/1f9740b.png alt=8-4></p><p>中断源的识别：</p><ul><li>单级中断中采用<strong>串行排队链</strong>实现公共请求线的中断源判优识别</li><li>也可以采用<strong>中断控制器</strong>判断</li></ul><p>转中断服务程序的方法：</p><ul><li>预先规定中断服务程序的入口地址</li><li>或使用中断向量（类似于设备的名字），通过链式查表的方式找到入口地址</li></ul><p>如图，使用中断向量和中断控制器，首先根据中断控制器获取中断向量</p><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/86685b8.png alt=8-5></p><p>然后根据中断向量链式查找设备入口地址</p><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/409c472.png alt=8-6></p><p><strong>单级中断</strong>不允许其他程序在中断中再次中断，中断响应不允许嵌套</p><p><strong>多级中断</strong>通常称为<strong>中断嵌套方式</strong>，优先级高的中断可以打断优先级低的中断。类似于高级语言中的函数嵌套。<strong>使用堆栈保存现场</strong></p><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/9926955.png alt=8-7></p><p><strong>二维多级中断结构</strong></p><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/bdc70f0.png alt=8-8></p><h3 id=dma方式>DMA方式<a hidden class=anchor aria-hidden=true href=#dma方式>#</a></h3><p>正常情况下外设从内存获得数据需要通过CPU的中转。而CPU为运算设计，所以单独设计一个用于数据转移的部件<strong>DMA控制器</strong></p><p>基本思想：通过硬件实现主存与IO设备的<strong>直接数据传送</strong>，传送过程中<strong>无需CPU干预</strong>，速度快</p><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/dcc3b56.png alt=8-2></p><p>过程：</p><ol><li>申请阶段 - DMA控制器收到DMA传送请求后向CPU发出总线请求信号申请占用总线</li><li>响应阶段 - CPU响应总线请求，释放总线，回送总线应答信号，表示已经让出总线</li><li>数据传送阶段 - DMA控制器收到总线应答信号后占用总线，分别向存储器和外设发出读写控制信号，完成数据传送操作，记录传送字的个数</li><li>传送结束阶段 - 规定字数传送完毕后DMA控制器以中断方式或状态位的方式向CPU报告，释放总线，CPU重新占用总线</li></ol><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/68301cc.png alt=8-9></p><p>DMA传送方式：</p><ul><li>成组传送<ul><li>传送过程中CPU停止访存</li><li>控制简单，适用于数据传输率很高的设备</li><li>但是CPU无法处理紧急事件，数据块也不能太大</li></ul></li></ul><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/9d494c6.png alt=8-10></p><ul><li>周期窃取<ul><li>每次占用一个CPU周期，只让CPU暂停工作一个周期</li><li>但是总线申请和归还存在过多的时间开销</li></ul></li></ul><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/1646684.png alt=8-11></p><ul><li>DMA与CPU交替访存<ul><li>不需要总线使用权的申请与归还，总线使用权通过C1和C2分时进行(C1+C2=CPU周期)</li><li>也称为<strong>透明DMA方式</strong>，CPU不停止主程序也不等待</li><li>前提条件：CPU工作周期比内存存取周期长很多</li></ul></li></ul><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/89ec251.png alt=8-12></p><h3 id=通道方式>通道方式<a hidden class=anchor aria-hidden=true href=#通道方式>#</a></h3><ul><li><strong>通道</strong>是计算机系统中代替CPU管理外设的独立部件，是一种<strong>能执行有限IO指令集的处理机</strong></li><li>一个主机可以连接几个通道，每个通道可以连接多个IO设备</li><li>通道完成IO操作而不需CPU介入，数据交换结束后向CPU发出中断请求交换数据</li></ul><p>通道类型：</p><ul><li>选择通道<ul><li>选择一台外设独占整个通道，以成组传送的方式传送数据块</li><li>效率高，适合快速设备</li></ul></li></ul><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/a762680.png alt=8-13></p><ul><li>字节多路通道<ul><li>简单的共享信道</li><li>分时处理，面向中低速字符设备</li></ul></li></ul><p><img loading=lazy src=https://discretetom.github.io/_nuxt/img/70b47ae.png alt=8-14></p><ul><li>数组多路通道<ul><li>多个设备以数据块为单位交叉使用通道。结合了以上两种方式</li><li>使用多个子通道实现</li><li>效率高，但控制复杂</li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/principles-of-computer-organization/>Principles of Computer Organization</a></li></ul><nav class=paginav><a class=prev href=/posts/principles-of-computer-organization/%E7%AC%AC7%E7%AB%A0-%E5%A4%96%E8%AE%BE/><span class=title>« Prev</span><br><span>第7章 外设</span></a>
<a class=next href=/posts/os/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%90%AF%E5%8A%A8/><span class=title>Next »</span><br><span>计算机启动</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 第8章 输入输出系统 on twitter" href="https://twitter.com/intent/tweet/?text=%e7%ac%ac8%e7%ab%a0%20%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e7%b3%bb%e7%bb%9f&url=%2fposts%2fprinciples-of-computer-organization%2f%25E7%25AC%25AC8%25E7%25AB%25A0-%25E8%25BE%2593%25E5%2585%25A5%25E8%25BE%2593%25E5%2587%25BA%25E7%25B3%25BB%25E7%25BB%259F%2f&hashtags=PrinciplesofComputerOrganization"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 第8章 输入输出系统 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=%2fposts%2fprinciples-of-computer-organization%2f%25E7%25AC%25AC8%25E7%25AB%25A0-%25E8%25BE%2593%25E5%2585%25A5%25E8%25BE%2593%25E5%2587%25BA%25E7%25B3%25BB%25E7%25BB%259F%2f&title=%e7%ac%ac8%e7%ab%a0%20%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e7%b3%bb%e7%bb%9f&summary=%e7%ac%ac8%e7%ab%a0%20%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e7%b3%bb%e7%bb%9f&source=%2fposts%2fprinciples-of-computer-organization%2f%25E7%25AC%25AC8%25E7%25AB%25A0-%25E8%25BE%2593%25E5%2585%25A5%25E8%25BE%2593%25E5%2587%25BA%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 第8章 输入输出系统 on reddit" href="https://reddit.com/submit?url=%2fposts%2fprinciples-of-computer-organization%2f%25E7%25AC%25AC8%25E7%25AB%25A0-%25E8%25BE%2593%25E5%2585%25A5%25E8%25BE%2593%25E5%2587%25BA%25E7%25B3%25BB%25E7%25BB%259F%2f&title=%e7%ac%ac8%e7%ab%a0%20%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e7%b3%bb%e7%bb%9f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 第8章 输入输出系统 on facebook" href="https://facebook.com/sharer/sharer.php?u=%2fposts%2fprinciples-of-computer-organization%2f%25E7%25AC%25AC8%25E7%25AB%25A0-%25E8%25BE%2593%25E5%2585%25A5%25E8%25BE%2593%25E5%2587%25BA%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 第8章 输入输出系统 on whatsapp" href="https://api.whatsapp.com/send?text=%e7%ac%ac8%e7%ab%a0%20%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e7%b3%bb%e7%bb%9f%20-%20%2fposts%2fprinciples-of-computer-organization%2f%25E7%25AC%25AC8%25E7%25AB%25A0-%25E8%25BE%2593%25E5%2585%25A5%25E8%25BE%2593%25E5%2587%25BA%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 第8章 输入输出系统 on telegram" href="https://telegram.me/share/url?text=%e7%ac%ac8%e7%ab%a0%20%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e7%b3%bb%e7%bb%9f&url=%2fposts%2fprinciples-of-computer-organization%2f%25E7%25AC%25AC8%25E7%25AB%25A0-%25E8%25BE%2593%25E5%2585%25A5%25E8%25BE%2593%25E5%2587%25BA%25E7%25B3%25BB%25E7%25BB%259F%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href>Home</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>